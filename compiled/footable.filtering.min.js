(function(t){t.Filter=t.Class.extend({construct:function(e,i,n,s){this.name=e,this.space=!t.is.string(s)||"OR"!=s&&"AND"!=s?"AND":s,this.query=new t.Query(i,this.space),this.columns=n},match:function(e){return t.is.string(e)?(t.is.string(this.query)&&(this.query=new t.Query(this.query,this.space)),this.query instanceof t.Query?this.query.match(e):!1):!1},matchRow:function(e){var i=this,n=t.arr.map(e.cells,function(e){return t.arr.contains(i.columns,e.column)?e.filterValue:null}).join(" ");return i.match(n)}})})(FooTable),function(t,e){e.Filtering=e.Component.extend({construct:function(t){this._super(t,t.o.filtering.enabled),this.filters=t.o.filtering.filters,this.delay=t.o.filtering.delay,this.min=t.o.filtering.min,this.space=t.o.filtering.space,this.placeholder=t.o.filtering.placeholder,this.position=t.o.filtering.position,this.$row=null,this.$cell=null,this.$dropdown=null,this.$input=null,this.$button=null,this._filterTimeout=null},preinit:function(t){var i=this;this.ft.raise("preinit.ft.filtering").then(function(){i.ft.$el.hasClass("footable-filtering")&&(i.enabled=!0),i.enabled=e.is.boolean(t.filtering)?t.filtering:i.enabled,i.enabled&&(i.space=e.is.string(t.filterSpace)?t.filteringSpace:i.space,i.min=e.is.number(t.filterMin)?t.filteringMin:i.min,i.delay=e.is.number(t.filterDelay)?t.filteringDelay:i.delay,i.placeholder=e.is.number(t.filterPlaceholder)?t.filterPlaceholder:i.placeholder,i.filters=e.is.array(t.filters)?i.ensure(t.filters):i.ensure(i.filters),i.ft.$el.hasClass("footable-filtering-left")&&(i.position="left"),i.ft.$el.hasClass("footable-filtering-center")&&(i.position="center"),i.ft.$el.hasClass("footable-filtering-right")&&(i.position="right"),i.position=e.is.string(t.filterPosition)?t.filterPosition:i.position)},function(){i.enabled=!1})},init:function(){var t=this;this.ft.raise("init.ft.filtering").then(function(){t.$create()},function(){t.enabled=!1})},destroy:function(){var t=this;this.ft.raise("destroy.ft.filtering").then(function(){t.ft.$el.removeClass("footable-filtering").find("thead > tr.footable-filtering").remove()})},$create:function(){var i,n=this,s=t("<div/>",{"class":"form-group"}).append(t("<label/>",{"class":"sr-only",text:"Search"})),r=t("<div/>",{"class":"input-group"}).appendTo(s),o=t("<div/>",{"class":"input-group-btn"}),a=t("<button/>",{type:"button","class":"btn btn-default dropdown-toggle"}).on("click",{self:n},n._onDropdownToggleClicked).append(t("<span/>",{"class":"caret"}));switch(n.position){case"left":i="footable-filtering-left";break;case"center":i="footable-filtering-center";break;default:i="footable-filtering-right"}n.ft.$el.addClass("footable-filtering").addClass(i),n.$row=t("<tr/>",{"class":"footable-filtering"}).prependTo(n.ft.$el.children("thead")),n.$cell=t("<th/>").attr("colspan",n.ft.columns.visibleColspan).appendTo(n.$row),n.$form=t("<form/>",{"class":"form-inline"}).append(s).appendTo(n.$cell),n.$input=t("<input/>",{type:"text","class":"form-control",placeholder:n.placeholder}),n.$button=t("<button/>",{type:"button","class":"btn btn-primary"}).on("click",{self:n},n._onSearchButtonClicked).append(t("<span/>",{"class":"fooicon fooicon-search"})),n.$dropdown=t("<ul/>",{"class":"dropdown-menu dropdown-menu-right"}).append(e.arr.map(n.ft.columns.array,function(e){return e.filterable&&e.visible?t("<li/>").append(t("<a/>",{"class":"checkbox"}).append(t("<label/>",{text:e.title}).prepend(t("<input/>",{type:"checkbox",checked:!0}).data("__FooTableColumn__",e)))):null})),n.delay>0&&(n.$input.on("keypress keyup",{self:n},n._onSearchInputChanged),n.$dropdown.on("click",'input[type="checkbox"]',n._onSearchColumnClicked)),o.append(n.$button,a,n.$dropdown),r.append(n.$input,o)},predraw:function(){if(!e.is.emptyArray(this.filters)){var i=this;i.ft.rows.array=t.grep(i.ft.rows.array,function(t){return t.filtered(i.filters)})}},draw:function(){this.$cell.attr("colspan",this.ft.columns.visibleColspan)},addFilter:function(t,i,n){var s=e.arr.first(this.filters,function(e){return e.name==t});s instanceof e.Filter?(s.name=t,s.query=i,s.columns=n):this.filters.push({name:t,query:i,columns:n})},removeFilter:function(t){e.arr.remove(this.filters,function(e){return e.name==t})},filter:function(i,n){return e.is.undef(i)?i=t.trim(this.$input.val()||""):this.$input.val(i),e.is.emptyString(i)?this.removeFilter("search"):this.addFilter("search",i,n),this.$button.children(".fooicon").removeClass("fooicon-search").addClass("fooicon-remove"),this._filter()},clear:function(){return this.$button.children(".fooicon").removeClass("fooicon-remove").addClass("fooicon-search"),this.$input.val(null),this.removeFilter("search"),this._filter()},columns:function(){return e.is.jq(this.$dropdown)?this.$dropdown.find("input:checked").map(function(){return t(this).data("__FooTableColumn__")}).get():this.ft.columns.get(function(t){return t.filterable})},ensure:function(t){var i=this,n=[],s=i.columns();return e.is.emptyArray(t)||e.arr.each(t,function(t){e.is.object(t)&&(!e.is.emptyString(t.query)||t.query instanceof e.Query)&&(t.name=e.is.emptyString(t.name)?"anon":t.name,t.columns=e.is.emptyArray(t.columns)?s:i.ft.columns.ensure(t.columns),n.push(t instanceof e.Filter?t:new e.Filter(t.name,t.query,t.columns,i.space)))}),n},_filter:function(){var t=this;return t.filters=t.ensure(t.filters),t.ft.raise("before.ft.filtering",[t.filters]).then(function(){return t.filters=t.ensure(t.filters),t.ft.draw().then(function(){t.ft.raise("after.ft.filtering",[t.filters])})})},_onSearchInputChanged:function(t){var i=t.data.self,n="keypress"==t.type&&!e.is.emptyString(String.fromCharCode(t.charCode)),s="keyup"==t.type&&(8==t.which||46==t.which);(n||s)&&(null!=i._filterTimeout&&clearTimeout(i._filterTimeout),i._filterTimeout=setTimeout(function(){i._filterTimeout=null,i.filter()},i.delay))},_onSearchButtonClicked:function(t){t.preventDefault();var e=t.data.self;null!=e._filterTimeout&&clearTimeout(e._filterTimeout);var i=e.$button.children(".fooicon");i.hasClass("fooicon-remove")?e.clear():e.filter()},_onSearchColumnClicked:function(t){var e=t.data.self;null!=e._filterTimeout&&clearTimeout(e._filterTimeout),e._filterTimeout=setTimeout(function(){e._filterTimeout=null;var t=e.$button.children(".fooicon");t.hasClass("fooicon-remove")&&(t.removeClass("fooicon-remove").addClass("fooicon-search"),e.filter())},e.delay)},_onDropdownToggleClicked:function(e){e.preventDefault(),e.stopPropagation();var i=e.data.self;i.$dropdown.parent().toggleClass("open"),i.$dropdown.parent().hasClass("open")?t(document).on("click.footable",{self:i},i._onDocumentClicked):t(document).off("click.footable",i._onDocumentClicked)},_onDocumentClicked:function(e){if(0==t(e.target).closest(".dropdown-menu").length){e.preventDefault();var i=e.data.self;i.$dropdown.parent().removeClass("open"),t(document).off("click.footable",i._onDocumentClicked)}}}),e.components.core.register("filtering",e.Filtering,10)}(jQuery,FooTable),function(t){t.Query=t.Class.extend({construct:function(e,i){this._original=null,this._value=null,this.space=!t.is.string(i)||"OR"!=i&&"AND"!=i?"AND":i,this.left=null,this.right=null,this.parts=[],this.operator=null,this.val(e)},val:function(e){if(t.is.emptyString(e))return this._value;if(t.is.emptyString(this._original))this._original=e;else if(this._original==e)return;this._value=e,this._parse()},match:function(e){return t.is.emptyString(this.operator)||"OR"===this.operator?this._left(e,!1)||this._match(e,!1)||this._right(e,!1):"AND"===this.operator?this._left(e,!0)&&this._match(e,!0)&&this._right(e,!0):void 0},_match:function(e,i){var n=this,s=!1;return t.is.emptyArray(n.parts)&&n.left instanceof t.Query?i:t.is.emptyArray(n.parts)?s:("OR"===n.space?t.arr.each(n.parts,function(i){var n=t.str.contains(e,i.query,!0);return n&&!i.negate&&(s=!0),n&&i.negate?s=!1:void 0}):(s=!0,t.arr.each(n.parts,function(i){var n=t.str.contains(e,i.query,!0);return(!n&&!i.negate||n&&i.negate)&&(s=!1),s})),s)},_left:function(e,i){return this.left instanceof t.Query?this.left.match(e):i},_right:function(e,i){return this.right instanceof t.Query?this.right.match(e):i},_parse:function(){if(!t.is.emptyString(this._value))if(/\sOR\s/.test(this._value)){this.operator="OR";var e=this._value.split(/(?:\sOR\s)(.*)?/);this.left=new t.Query(e[0],this.space),this.right=new t.Query(e[1],this.space)}else if(/\sAND\s/.test(this._value)){this.operator="AND";var i=this._value.split(/(?:\sAND\s)(.*)?/);this.left=new t.Query(i[0],this.space),this.right=new t.Query(i[1],this.space)}else this.parts=t.arr.map(this._value.match(/(?:[^\s"]+|"[^"]*")+/g),this._part)},_part:function(e){var i={query:e,negate:!1,phrase:!1,exact:!1};return t.str.startsWith(i.query,"-")&&(i.query=t.str.from(i.query,"-"),i.negate=!0),/^"(.*?)"$/.test(i.query)?(i.query=i.query.replace(/^"(.*?)"$/,"$1"),i.phrase=!0,i.exact=!0):/(?:\w)+?([-_\+\.])(?:\w)+?/.test(i.query)&&(i.query=i.query.replace(/(?:\w)+?([-_\+\.])(?:\w)+?/g,function(t,e){return t.replace(e," ")}),i.phrase=!0),i}})}(FooTable),function(t){t.Cell.prototype.filterValue=null,t.Cell.prototype.__filtering_define__=function(t){this.filterValue=this.column.filterValue.call(this.column,t)},t.Cell.prototype.__filtering_val__=function(e){t.is.defined(e)&&(this.filterValue=this.column.filterValue.call(this.column,e))},t.Cell.extend("define",function(t){this._super(t),this.__filtering_define__(t)}),t.Cell.extend("val",function(t){var e=this._super(t);return this.__filtering_val__(t),e})}(FooTable),function(t,e){e.Column.prototype.filterable=!0,e.Column.prototype.filterValue=function(i){if(e.is.element(i)||e.is.jq(i))return t(i).data("filterValue")||t(i).text();if(e.is.hash(i)&&e.is.hash(i.options)){if(e.is.string(i.options.filterValue))return i.options.filterValue;e.is.defined(i.value)&&(i=i.value)}return e.is.defined(i)&&null!=i?i+"":""},e.Column.prototype.__filtering_define__=function(t){this.filterable=e.is.boolean(t.filterable)?t.filterable:this.filterable},e.Column.extend("define",function(t){this._super(t),this.__filtering_define__(t)})}(jQuery,FooTable),function(t){t.Defaults.prototype.filtering={enabled:!1,filters:[],delay:1200,min:3,space:"AND",placeholder:"Search",position:"right"}}(FooTable),function(t){t.Row.prototype.filtered=function(e){var i=!0,n=this;return t.arr.each(e,function(t){return 0==(i=t.matchRow(n))?!1:void 0}),i}}(FooTable),function(t){t.Table.prototype.applyFilter=function(e,i){return this.use(t.Filtering).filter(e,i)},t.Table.prototype.clearFilter=function(){return this.use(t.Filtering).clear()}}(FooTable);